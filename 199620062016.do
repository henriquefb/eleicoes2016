///////////////////////////////////////////////////////////////////////////////
///////////////////////////////// ESCRITO POR /////////////////////////////////
///////////////////////////////// CARLOS GÓES /////////////////////////////////
////////////////////////////////////// E //////////////////////////////////////
//////////////////////////////// RADUAN MEIRA /////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
///////////////////////// INSTITUTO MERCADO POPULAR ///////////////////////////
/////////////////////////// www.mercadopopular.org ////////////////////////////
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
////////////////////////////////// LEIA-ME ////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

/*

Descrição do projeto

- Baixar dados do TSE entre 1996 e 2016
- Detalhar o perfil eleitoral por educação e tamanho do município

 
 */
///////////////////////////////////////////////////////////////////////////////
////////////////////////////////// INTERFACE //////////////////////////////////
//////////// ALTERE OS VALORES DESTA SEÇÃO PARA CUSTOMIZAR A ANÁLISE //////////
///////////////////////////////////////////////////////////////////////////////

// Defina seu diretório de trabalho
	local diretorio = "U:\Research\partidos\basededados"

 
///////////////////////////////////////////////////////////////////////////////
///////////////////////// CÓDIGO (USUÁRIOS AVANÇADOS) /////////////////////////
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
/////////////////////////// 1. ORGANIZAÇÃO DO ESPAÇO //////////////////////////
///////////////////////////////////////////////////////////////////////////////
 
capture log close 										// closes any open logs
clear 													// clears the memory
clear matrix 											// clears matrix memory
clear mata 												// clears mata memory
cd "`diretorio'" 
set more off  																					
log using dados.log, replace  	

///////////////////////////////////////////////////////////////////////////////
/////////////////////////// 2. PREPARAÇÃO DOS DADOS ///////////////////////////
///////////////////////////////////////////////////////////////////////////////


	// loop

	forval x = 1996(2)2016 {
		copy "http://agencia.tse.jus.br/estatistica/sead/odsele/perfil_eleitorado/perfil_eleitorado_`x'.zip" perfil_eleitorado_`x'.zip, replace
		unzipfile perfil_eleitorado_`x'.zip, replace
		import delimited perfil_eleitorado_`x'.txt, delimiter(";") clear
		drop v5
		rename v1 ano
		rename v2 estado
		rename v3 municipio
		rename v4 zona_eleitoral
		rename v6 sexo
		rename v7 faixa_idade
		rename v8 escolaridade
		rename v9 quantidade_em_faixa
		
		preserve
			collapse (sum) quantidade_em_faixa, by(escolaridade)
			export excel eleitorado_escolaridade.xlsx, sheet("`x'", replace)
		restore

		preserve
			collapse (sum) quantidade_em_faixa, by(estado municipio)
			export excel eleitorado_municipios.xlsx, sheet("`x'", replace)
		restore

	}

